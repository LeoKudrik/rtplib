#!/usr/bin/escript
%% -*- erlang -*-

-include_lib("rtplib/include/rtcp.hrl").

main(_) ->
	etap:plan(5),

	BinRtp1 = <<128,128,51,27,9,120,82,160,12,197,12,227,253,253,254,253,
		253,254,254,254,254,253,253,253,253,253,254,254,254,254,254,254,
		254,255,254,255,127,254,254,254,255,127,126,126,126,127,126,126,
		127,127,255,255,254,254,254,254,253,254,254,254,255,127,254,255,
		127,255,255,255,127,127,255,255,255,255,127,255,127,126,127,127,
		126,126,126,125,126,126,126,125,125,125,125,125,126,125,125,125,
		126,127,126,127,127,126,255,255,254,253,254,253,253,254,254,253,
		254,254,255,255,254,126,254,255,127,254,254,253,254,127,254,255,
		126,254,125,126,127,126,127,126,126,126,127,127,126,127,125,126,
		126,125,255,126,126,126,126,125,124,126,126,126,126,125,127,255,
		126,254,254,127,254,255,127,254,254,253,254,253>>,

	BinRtp2 = <<128,0,51,28,9,120,83,64,12,197,12,227,253,254,253,253,254,
		253,254,254,253,254,255,254,254,254,254,127,255,255,255,254,255,
		127,255,127,255,127,127,254,127,126,127,125,125,126,127,126,126,
		126,126,126,127,127,255,254,254,255,254,254,254,255,255,253,254,
		255,254,254,127,253,255,126,254,255,254,255,126,126,126,125,125,
		126,126,126,126,125,127,126,126,126,127,255,125,127,127,126,255,
		127,127,127,127,126,127,126,125,127,125,126,254,255,127,254,255,
		255,254,254,254,254,253,254,255,254,254,252,254,255,253,127,127,
		254,255,254,255,254,254,255,254,127,127,254,255,255,255,255,254,
		255,255,254,127,126,127,127,126,127,126,126,254,127,255,255,126,
		127,127,254,254,254,254,255,254,255,254,254>>,

	BinRtp3 = <<128,101,221,245,9,229,4,64,12,197,12,227,7,10,2,128>>,

	BinRtp4 = <<128,101,221,228,9,228,251,128,12,197,12,227,8,138,3,192>>,

	BinRtp5 = <<128,128,221,21,9,228,158,96,12,197,12,227,253,252,253,253,
		253,255,127,126,125,126,126,126,127,126,126,255,254,254,254,255,
		254,253,254,254,254,254,254,255,255,127,127,255,255,127,255,254,
		254,254,254,254,254,255,127,127,127,127,255,127,126,126,125,126,
		127,127,255,255,255,127,127,126,126,255,255,254,253,254,254,254,
		255,255,255,255,127,255,254,254,253,253,253,253,253,254,127,255,
		127,254,254,255,255,127,127,127,126,255,127,127,127,127,255,127,
		127,255,126,126,125,126,126,126,126,126,126,127,255,255,127,127,
		254,254,253,253,252,253,254,254,254,254,254,253,254,253,253,253,
		253,253,253,254,253,254,254,254,253,253,253,253,253,253,254,253,
		253,254,255,255,254,253,253,253,253,252,253,254>>,

	{ok, Rtp1} = rtp:decode(BinRtp1),
	{ok, Rtp2} = rtp:decode(BinRtp2),
	{ok, Rtp3} = rtp:decode(BinRtp3),
	{ok, Rtp4} = rtp:decode(BinRtp4),
	{ok, Rtp5} = rtp:decode(BinRtp5),

	etap:is(BinRtp1, rtp:encode(Rtp1), "Check that we can reproduce original data stream from RTP 1"),
	etap:is(BinRtp2, rtp:encode(Rtp2), "Check that we can reproduce original data stream from RTP 2"),
	etap:is(BinRtp3, rtp:encode(Rtp3), "Check that we can reproduce original data stream from RTP 3"),
	etap:is(BinRtp4, rtp:encode(Rtp4), "Check that we can reproduce original data stream from RTP 4"),
	etap:is(BinRtp5, rtp:encode(Rtp5), "Check that we can reproduce original data stream from RTP 4"),

	etap:end_tests().
